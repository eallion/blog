<!doctype html><html lang=zh-cn dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>图床 CDN CNAME 接入 Cloudflare SaaS 实现分流 &#183; 大大的小蜗牛</title><meta name=title content="图床 CDN CNAME 接入 Cloudflare SaaS 实现分流 &#183; 大大的小蜗牛"><meta name=description content="通过 Cloudflare for SaaS 实现国内外流量分流，国内使用阿里云或腾讯云 CDN 及对象存储，境外则利用 Cloudflare CDN 和 R2 或 Backblaze B2 存储桶。无需将域名 NS 接入 Cloudflare，通过 CNAME 解析和 Worker 代理实现分区解析和资源访问，优化性能并降低成本。"><meta name=keywords content="hugo,blog,cname,cloudflare,"><link rel=canonical href=https://www.eallion.com/cdn-cname-cloudflare/><link rel=alternate type=application/rss+xml href=/cdn-cname-cloudflare/index.xml title=大大的小蜗牛><link type=text/css rel=stylesheet href=/css/main.bundle.min.392d322d1dcc8b0876e9dbe3949be15d754b5cf7b206d3fcf9fed561e5ff427f20c42161f1440666f8754c29d77aaab1d7349ca4ac8da61cac2b39787d519bb6.css integrity="sha512-OS0yLR3Miwh26dvjlJvhXXVLXPeyBtP8+f7VYeX/Qn8gxCFh8UQGZvh1TCnXeqqx1zScpKyNphysKzl4fVGbtg=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.98bb8ce8f123e03c4d2171eeec151dd404b5c476beb5ef1068d0e8b1a2afb923065e6552fc14b2d867c85ee4bd8529a43193f729f874d3908517ba03b5d1cc57.js integrity="sha512-mLuM6PEj4DxNIXHu7BUd1AS1xHa+te8QaNDosaKvuSMGXmVS/BSy2GfIXuS9hSmkMZP3Kfh005CFF7oDtdHMVw==" data-copy=复制 data-copied=已复制></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=google-site-verification content="9Mvl_9FEM5JphVmp-u9ljtlChFohWuBBFjlSS89QKVU"><meta name=msvalidate.01 content="68A03C00DAFAD54E3739A8D372D9371B"><meta name=p:domain_verify content="b9e3534b99f9bd82f3b8688a1fa122a8"><meta name=yandex-verification content="ff49a8cfbbaad423"><meta name=fediverse:creator content="@eallion@e5n.cc"><meta property="og:url" content="https://www.eallion.com/cdn-cname-cloudflare/"><meta property="og:site_name" content="大大的小蜗牛"><meta property="og:title" content="图床 CDN CNAME 接入 Cloudflare SaaS 实现分流"><meta property="og:description" content="通过 Cloudflare for SaaS 实现国内外流量分流，国内使用阿里云或腾讯云 CDN 及对象存储，境外则利用 Cloudflare CDN 和 R2 或 Backblaze B2 存储桶。无需将域名 NS 接入 Cloudflare，通过 CNAME 解析和 Worker 代理实现分区解析和资源访问，优化性能并降低成本。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-07-29T06:35:49+00:00"><meta property="article:modified_time" content="2025-04-02T01:44:54+08:00"><meta property="article:tag" content="Hugo"><meta property="article:tag" content="Blog"><meta property="article:tag" content="Cname"><meta property="article:tag" content="Cloudflare"><meta property="og:image" content="https://www.eallion.com/cdn-cname-cloudflare/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.eallion.com/cdn-cname-cloudflare/featured.png"><meta name=twitter:title content="图床 CDN CNAME 接入 Cloudflare SaaS 实现分流"><meta name=twitter:description content="通过 Cloudflare for SaaS 实现国内外流量分流，国内使用阿里云或腾讯云 CDN 及对象存储，境外则利用 Cloudflare CDN 和 R2 或 Backblaze B2 存储桶。无需将域名 NS 接入 Cloudflare，通过 CNAME 解析和 Worker 代理实现分区解析和资源访问，优化性能并降低成本。"><meta name=twitter:image content="https://www.eallion.com/cdn-cname-cloudflare/featured.png"><meta property="og:image" content="https://www.eallion.com/cdn-cname-cloudflare/featured.png"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"图床 CDN CNAME 接入 Cloudflare SaaS 实现分流","headline":"图床 CDN CNAME 接入 Cloudflare SaaS 实现分流","abstract":"通过 Cloudflare for SaaS 实现国内外流量分流，国内使用阿里云或腾讯云 CDN 及对象存储，境外则利用 Cloudflare CDN 和 R2 或 Backblaze B2 存储桶。无需将域名 NS 接入 Cloudflare，通过 CNAME 解析和 Worker 代理实现分区解析和资源访问，优化性能并降低成本。","inLanguage":"zh-cn","url":"https:\/\/www.eallion.com\/cdn-cname-cloudflare\/","author":{"@type":"Person","name":"大大的小蜗牛"},"copyrightYear":"2023","dateCreated":"2023-07-29T06:35:49\u002b00:00","datePublished":"2023-07-29T06:35:49\u002b00:00","dateModified":"2025-04-02T01:44:54\u002b08:00","keywords":["hugo","blog","cname","cloudflare"],"mainEntityOfPage":"true","wordCount":"3521"}]</script><meta name=author content="大大的小蜗牛"><link href=https://e5n.cc/@eallion rel=me><link href=https://github.com/eallion rel=me><link href=https://x.com/eallion rel=me><link href="https://i.delta.chat/#a=eallion%40e5n.cc&amp;n=Charles%20Chin" rel=me><link href=https://steamcommunity.com/id/eallion rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">大大的小蜗牛</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/blog/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Blogs>博客</p></a><a href=/mastodon/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=嘀咕>嘀咕</p></a><a href=/media/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=书影音>书影音</p></a><a href=/milestone/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=里程碑>里程碑</p></a><div><div class="cursor-pointer flex items-center nested-menu"><a class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title>更多
</a><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/stats/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title=博客统计>统计</p></a><a href=/album/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title=随手拍>随手拍</p></a><a href=/penta/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title=我的五杀>LOL 五杀</p></a><a href=/goods/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title="好物 beta">好物分享</p></a><a href=/copyright/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title=版权信息>版权信息</p></a><a href=/privacy-policy/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title=隐私政策>隐私政策</p></a><a href=https://status.eallion.com/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg width="1rem" height="1rem" viewBox="0 0 32 32"><path fill="currentColor" d="M18 5v2h5.563L11.28 19.281l1.438 1.438L25 8.437V14h2V5zM5 9v18h18V14l-2 2v9H7V11h9l2-2z"/></svg></span></span><p class="text-sm font-sm" title>Status</p></a></div></div></div></div><a href=/links/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=友情链接>友情链接</p></a><a href=/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=关于>关于</p></a><a href=https://deepwiki.com/eallion/eallion.com target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg class="size-4 transform transition-transform duration-700 group-hover:rotate-180 [&amp;_path]:stroke-0" viewBox="110 110 460 500"><path class="" d="M418.73 332.37c9.84-5.68 22.07-5.68 31.91.0l25.49 14.71c.82.48 1.69.8 2.58 1.06.19.06.37.11.55.16.87.21 1.76.34 2.65.35.04.0.08.02.13.02.1.0.19-.03.29-.04.83-.02 1.64-.13 2.45-.32.14-.03.28-.05.42-.09.87-.24 1.7-.59 2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81.0l-50.97 29.43c-.08.04-.13.11-.2.16-.78.48-1.51 1.02-2.15 1.66-.1.1-.18.21-.28.31-.57.6-1.08 1.26-1.51 1.97-.07.12-.15.22-.22.34-.44.77-.77 1.6-1.03 2.47-.05.19-.1.37-.14.56-.22.89-.37 1.81-.37 2.76v29.43c0 11.36-6.11 21.95-15.95 27.63s-22.06 5.68-31.91.0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13.0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51 1.04-.08.04-.16.06-.24.1l-50.97 29.43c-3.65 2.11-5.9 6.01-5.9 10.22v58.86c0 4.22 2.25 8.11 5.9 10.22l50.97 29.43c.08.04.17.06.24.1.8.44 1.64.79 2.5 1.03.14.04.28.06.42.09.81.19 1.62.3 2.45.32.1.0.19.04.29.04.04.0.08-.02.13-.02.89.0 1.77-.13 2.65-.35.19-.04.37-.1.56-.16.88-.26 1.75-.59 2.58-1.06l25.49-14.71c9.84-5.68 22.06-5.68 31.91.0 9.84 5.68 15.95 16.27 15.95 27.63v29.43c0 .95.15 1.87.37 2.76.05.19.09.37.14.56.25.86.59 1.69 1.03 2.47.07.12.15.22.22.34.43.71.94 1.37 1.51 1.97.1.1.18.21.28.31.65.63 1.37 1.18 2.15 1.66.07.04.13.11.2.16l50.97 29.43c1.83 1.05 3.86 1.58 5.9 1.58s4.08-.53 5.9-1.58l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22V412.6c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13.0-.25-.02-.38-.02-.89.0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58 1.07l-25.49 14.72c-9.84 5.68-22.07 5.68-31.9.0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95 15.95-27.63z" style="fill:#21c19a"/><path d="M141.09 317.65l50.97 29.43c1.83 1.05 3.86 1.58 5.9 1.58s4.08-.53 5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48 1.51-1.02 2.15-1.66.1-.1.18-.21.28-.31.57-.6 1.08-1.26 1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6 1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36 6.11-21.95 15.96-27.63s22.06-5.68 31.91.0l25.49 14.71c.82.48 1.69.8 2.57 1.06.19.06.37.11.56.16.87.21 1.76.34 2.64.35.04.0.09.02.13.02.1.0.19-.04.29-.04.83-.02 1.65-.13 2.45-.32.14-.03.28-.05.41-.09.87-.24 1.71-.6 2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81.0l-50.97 29.43c-.08.04-.13.11-.2.16-.78.48-1.51 1.02-2.15 1.66-.1.1-.18.21-.28.31-.57.6-1.08 1.26-1.51 1.97-.07.12-.15.22-.22.34-.44.77-.77 1.6-1.03 2.47-.05.19-.1.37-.14.56-.22.89-.37 1.81-.37 2.76V196c0 11.36-6.11 21.95-15.95 27.63-9.84 5.68-22.07 5.68-31.91.0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13.0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51 1.04-.08.04-.16.06-.24.1l-50.97 29.43c-3.65 2.11-5.9 6.01-5.9 10.22v58.86c0 4.22 2.25 8.11 5.9 10.22z" style="fill:#3969ca"/><path class="" d="M396.88 484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13.0-.26-.02-.39-.02-.89.0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58 1.07l-25.49 14.72c-9.84 5.68-22.06 5.68-31.9.0s-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81.0l-50.97 29.43c-3.65 2.11-5.9 6.01-5.9 10.22v58.86c0 4.22 2.25 8.11 5.9 10.22l50.97 29.43c.08.04.17.06.25.1.8.44 1.63.79 2.5 1.03.14.04.29.06.43.09.8.19 1.61.3 2.43.32.1.0.2.04.3.04.04.0.09-.02.13-.02.88.0 1.77-.13 2.64-.34.19-.04.37-.1.56-.16.88-.26 1.75-.59 2.57-1.06l25.49-14.71c9.84-5.68 22.06-5.68 31.91.0 9.84 5.68 15.95 16.27 15.95 27.63v29.43c0 .95.15 1.87.37 2.76.05.19.09.37.14.56.25.86.59 1.69 1.03 2.47.07.12.15.22.22.34.43.71.94 1.37 1.51 1.97.1.1.18.21.28.31.65.63 1.37 1.18 2.15 1.66.07.04.13.11.2.16l50.97 29.43c1.83 1.05 3.86 1.58 5.9 1.58s4.08-.53 5.9-1.58l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22z" style="fill:#0294de"/></svg></span></span><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="搜索 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="搜索 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/blog/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Blogs>博客</p></a></li><li class=mt-1><a href=/mastodon/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=嘀咕>嘀咕</p></a></li><li class=mt-1><a href=/media/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=书影音>书影音</p></a></li><li class=mt-1><a href=/milestone/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=里程碑>里程碑</p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>更多</p><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></a></li><li class=mt-1><a href=/stats/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title=博客统计>统计</p></a></li><li class=mt-1><a href=/album/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title=随手拍>随手拍</p></a></li><li class=mt-1><a href=/penta/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title=我的五杀>LOL 五杀</p></a></li><li class=mt-1><a href=/goods/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title="好物 beta">好物分享</p></a></li><li class=mt-1><a href=/copyright/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title=版权信息>版权信息</p></a></li><li class=mt-1><a href=/privacy-policy/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title=隐私政策>隐私政策</p></a></li><li class=mt-1><a href=https://status.eallion.com/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg width="1rem" height="1rem" viewBox="0 0 32 32"><path fill="currentColor" d="M18 5v2h5.563L11.28 19.281l1.438 1.438L25 8.437V14h2V5zM5 9v18h18V14l-2 2v9H7V11h9l2-2z"/></svg></span></span><p class="text-sm font-small" title>Status</p></a></li><li class=mb-2></li><li class=mt-1><a href=/links/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=友情链接>友情链接</p></a></li><li class=mt-1><a href=/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=关于>关于</p></a></li><li class=mt-1><a href=https://deepwiki.com/eallion/eallion.com target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg class="size-4 transform transition-transform duration-700 group-hover:rotate-180 [&amp;_path]:stroke-0" viewBox="110 110 460 500"><path class="" d="M418.73 332.37c9.84-5.68 22.07-5.68 31.91.0l25.49 14.71c.82.48 1.69.8 2.58 1.06.19.06.37.11.55.16.87.21 1.76.34 2.65.35.04.0.08.02.13.02.1.0.19-.03.29-.04.83-.02 1.64-.13 2.45-.32.14-.03.28-.05.42-.09.87-.24 1.7-.59 2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81.0l-50.97 29.43c-.08.04-.13.11-.2.16-.78.48-1.51 1.02-2.15 1.66-.1.1-.18.21-.28.31-.57.6-1.08 1.26-1.51 1.97-.07.12-.15.22-.22.34-.44.77-.77 1.6-1.03 2.47-.05.19-.1.37-.14.56-.22.89-.37 1.81-.37 2.76v29.43c0 11.36-6.11 21.95-15.95 27.63s-22.06 5.68-31.91.0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13.0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51 1.04-.08.04-.16.06-.24.1l-50.97 29.43c-3.65 2.11-5.9 6.01-5.9 10.22v58.86c0 4.22 2.25 8.11 5.9 10.22l50.97 29.43c.08.04.17.06.24.1.8.44 1.64.79 2.5 1.03.14.04.28.06.42.09.81.19 1.62.3 2.45.32.1.0.19.04.29.04.04.0.08-.02.13-.02.89.0 1.77-.13 2.65-.35.19-.04.37-.1.56-.16.88-.26 1.75-.59 2.58-1.06l25.49-14.71c9.84-5.68 22.06-5.68 31.91.0 9.84 5.68 15.95 16.27 15.95 27.63v29.43c0 .95.15 1.87.37 2.76.05.19.09.37.14.56.25.86.59 1.69 1.03 2.47.07.12.15.22.22.34.43.71.94 1.37 1.51 1.97.1.1.18.21.28.31.65.63 1.37 1.18 2.15 1.66.07.04.13.11.2.16l50.97 29.43c1.83 1.05 3.86 1.58 5.9 1.58s4.08-.53 5.9-1.58l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22V412.6c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13.0-.25-.02-.38-.02-.89.0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58 1.07l-25.49 14.72c-9.84 5.68-22.07 5.68-31.9.0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95 15.95-27.63z" style="fill:#21c19a"/><path d="M141.09 317.65l50.97 29.43c1.83 1.05 3.86 1.58 5.9 1.58s4.08-.53 5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48 1.51-1.02 2.15-1.66.1-.1.18-.21.28-.31.57-.6 1.08-1.26 1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6 1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36 6.11-21.95 15.96-27.63s22.06-5.68 31.91.0l25.49 14.71c.82.48 1.69.8 2.57 1.06.19.06.37.11.56.16.87.21 1.76.34 2.64.35.04.0.09.02.13.02.1.0.19-.04.29-.04.83-.02 1.65-.13 2.45-.32.14-.03.28-.05.41-.09.87-.24 1.71-.6 2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81.0l-50.97 29.43c-.08.04-.13.11-.2.16-.78.48-1.51 1.02-2.15 1.66-.1.1-.18.21-.28.31-.57.6-1.08 1.26-1.51 1.97-.07.12-.15.22-.22.34-.44.77-.77 1.6-1.03 2.47-.05.19-.1.37-.14.56-.22.89-.37 1.81-.37 2.76V196c0 11.36-6.11 21.95-15.95 27.63-9.84 5.68-22.07 5.68-31.91.0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13.0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51 1.04-.08.04-.16.06-.24.1l-50.97 29.43c-3.65 2.11-5.9 6.01-5.9 10.22v58.86c0 4.22 2.25 8.11 5.9 10.22z" style="fill:#3969ca"/><path class="" d="M396.88 484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13.0-.26-.02-.39-.02-.89.0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58 1.07l-25.49 14.72c-9.84 5.68-22.06 5.68-31.9.0s-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81.0l-50.97 29.43c-3.65 2.11-5.9 6.01-5.9 10.22v58.86c0 4.22 2.25 8.11 5.9 10.22l50.97 29.43c.08.04.17.06.25.1.8.44 1.63.79 2.5 1.03.14.04.29.06.43.09.8.19 1.61.3 2.43.32.1.0.2.04.3.04.04.0.09-.02.13-.02.88.0 1.77-.13 2.64-.34.19-.04.37-.1.56-.16.88-.26 1.75-.59 2.57-1.06l25.49-14.71c9.84-5.68 22.06-5.68 31.91.0 9.84 5.68 15.95 16.27 15.95 27.63v29.43c0 .95.15 1.87.37 2.76.05.19.09.37.14.56.25.86.59 1.69 1.03 2.47.07.12.15.22.22.34.43.71.94 1.37 1.51 1.97.1.1.18.21.28.31.65.63 1.37 1.18 2.15 1.66.07.04.13.11.2.16l50.97 29.43c1.83 1.05 3.86 1.58 5.9 1.58s4.08-.53 5.9-1.58l50.97-29.43c3.65-2.11 5.9-6.01 5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22z" style="fill:#0294de"/></svg></span></div><p class="text-bg font-bg" title></p></a></li></ul></div></div></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.78ad5090e7c0c2533bac9dd23bdb1f723f834e5c3626627bd31017cc139ce0651b529877862129cee49e380ab2fdcd8baef28ae3e086bc54957fdaa7758775b2.js integrity="sha512-eK1QkOfAwlM7rJ3SO9sfcj+DTlw2JmJ70xAXzBOc4GUbUph3hiEpzuSeOAqy/c2LrvKK4+CGvFSVf9qndYd1sg==" data-target-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class="grow heti"><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/cdn-cname-cloudflare/background_hu_e24693d242f9c8d0.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.78ad5090e7c0c2533bac9dd23bdb1f723f834e5c3626627bd31017cc139ce0651b529877862129cee49e380ab2fdcd8baef28ae3e086bc54957fdaa7758775b2.js integrity="sha512-eK1QkOfAwlM7rJ3SO9sfcj+DTlw2JmJ70xAXzBOc4GUbUph3hiEpzuSeOAqy/c2LrvKK4+CGvFSVf9qndYd1sg==" data-target-id=background-blur></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>大大的小蜗牛</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/blog/>Blogs</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/cdn-cname-cloudflare/>图床 CDN CNAME 接入 Cloudflare SaaS 实现分流</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">图床 CDN CNAME 接入 Cloudflare SaaS 实现分流</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-07-29T06:35:49+00:00>Jul 29, 2023</time><span class="px-2 text-primary-500">&#183;</span><span>3521 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>8 分钟</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/eallion/eallion.com/tree/main/content/blog/code/cdn-cname-cloudflare/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title=编辑内容><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>
</span></span></a></span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.2a0a1375509c03daf41c53a9831aa2d560895b7a2528c3eb3b56e7b11a135c7529e49727162a053b6193be8340270a8342f42c69f3d7e262ae54bc248eaac8f5.js integrity="sha512-KgoTdVCcA9r0HFOpgxqi1WCJW3olKMPrO1bnsRoTXHUp5JcnFioFO2GTvoNAJwqDQvQsafPX4mKuVLwkjqrI9Q=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title data-title-i18n-disable data-title-i18n-enable><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span class="mr-2 mt-[0.5rem]" onclick='return window.open("/categories/%E4%BB%A3%E7%A0%81/","_self"),!1'><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">代码
</span></span></span><span class="mr-2 mt-[0.5rem]" onclick='return window.open("/slug/cdn-cname-cloudflare/","_self"),!1'><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Cdn-Cname-Cloudflare
</span></span></span><span class="mr-2 mt-[0.5rem]" onclick='return window.open("/tags/hugo/","_self"),!1'><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Hugo
</span></span></span><span class="mr-2 mt-[0.5rem]" onclick='return window.open("/tags/blog/","_self"),!1'><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Blog
</span></span></span><span class="mr-2 mt-[0.5rem]" onclick='return window.open("/tags/cname/","_self"),!1'><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Cname
</span></span></span><span class="mr-2 mt-[0.5rem]" onclick='return window.open("/tags/cloudflare/","_self"),!1'><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Cloudflare</span></span></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#前言>前言</a></li><li><a href=#创建-r2-并绑定自定义域名>创建 R2 并绑定自定义域名</a></li><li><a href=#订阅-cloudflare-for-saas>订阅 CloudFlare for SaaS</a></li><li><a href=#添加自定义域名>添加自定义域名</a></li><li><a href=#解析-cname>解析 CNAME</a></li><li><a href=#新建-worker-代理-r2>新建 Worker 代理 R2</a></li><li><a href=#workers-路由>Workers 路由</a></li><li><a href=#worker-代理-backblaze-b2>Worker 代理 Backblaze B2</a><ul><li></li></ul></li><li><a href=#尾声>尾声</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#前言>前言</a></li><li><a href=#创建-r2-并绑定自定义域名>创建 R2 并绑定自定义域名</a></li><li><a href=#订阅-cloudflare-for-saas>订阅 CloudFlare for SaaS</a></li><li><a href=#添加自定义域名>添加自定义域名</a></li><li><a href=#解析-cname>解析 CNAME</a></li><li><a href=#新建-worker-代理-r2>新建 Worker 代理 R2</a></li><li><a href=#workers-路由>Workers 路由</a></li><li><a href=#worker-代理-backblaze-b2>Worker 代理 Backblaze B2</a><ul><li></li></ul></li><li><a href=#尾声>尾声</a></li></ul></li></ul></nav></div></details><script>(function(){"use strict";const n=.33,s="#TableOfContents",o=".anchor",i='a[href^="#"]',a="li ul",r="active";function c(e,t){const s=window.scrollY+window.innerHeight*t,o=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],n=new Set(o.map(e=>e.getAttribute("href").substring(1)));for(let t=e.length-1;t>=0;t--){const o=e[t].getBoundingClientRect().top+window.scrollY;if(o<=s&&n.has(e[t].id))return e[t].id}return e.find(e=>n.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=c(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(r,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function t(){const t=document.querySelector(s);if(!t)return;const c=!1,l=[...document.querySelectorAll(o)],d=[...t.querySelectorAll(i)];c&&t.querySelectorAll(a).forEach(e=>e.style.display="none");const r={toc:t,anchors:l,links:d,scrollOffset:n,collapseInactive:c};window.addEventListener("scroll",()=>e(r),{passive:!0}),window.addEventListener("hashchange",()=>e(r),{passive:!0}),e(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h3 class="relative group">TL;DR<div id=tldr class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#tldr aria-label=锚点>#</a></span></h3><p>本文比较长，也比较罗嗦，需要实现如下功能请再往下读：</p><ul><li>域名 NS 不打算接入 Cloudflare</li><li>同一 CDN 域名，国内走国内流量，境外走 Cloudflare 流量</li><li>国内用阿里云、腾讯云等服务商的 CDN 和对象存储</li><li>境外用 Cloudflare 的 CDN</li><li>境外用 Cloudflare R2 或 Backblaze B2 作为存储桶</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/cdn_dns.png></figure></p><h3 class="relative group">前言<div id=前言 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e5%89%8d%e8%a8%80 aria-label=锚点>#</a></span></h3><p>国内、境外分流，不光能削减成本，还能提高网站性能，优化 TTFB。</p><p>不记得是什么时候开始有了一个这样的闪念，然后就去搜索了一下。<br>结果发现网上的教程都比较老旧。其中讲得比较多的是通过 CloudFlare for SaaS 接入 CNAME，但是都支持普通的域名，并不能接入 R2 或者 Worker。</p><p>从功能的优先级上来说，我最需要的是分区解析功能，这就导致不能把域名的 NS 转入 Cloudflare。<br>Cloudflare 的 DNS 确实非常优秀，但 Cloudflare 不能分区解析，它有 CNAME 拉平功能，不过它会把所有中国大陆地区的 IP 解析到联通。<br>相反国内的 DNS 服务商的分区解析就做得好，可能也是因为国内的域名更需要这种功能吧。<br>无法全心全意付出，又想去贴贴 Cloudflare，那就只能搞些奇技淫巧。</p><p>2022 年 3 月份，CloudFlare 宣布更改了 CloudFlare for SaaS 的收费策略，每个账户可以有 100 个域名免费额度，而且超额后每个域名按 0.1 USD/月 收取费用。我们就利用 CloudFlare for SaaS 把域名通过 CNAME 接入 Cloudflare，享受 Cloudflare 强大的边缘计算能力。</p><p>对于小网站，比如本博客，以上服务都是免费的，免费额度：</p><ul><li>DNSPod：用的专业版，但免费版本也有分区解析</li><li>腾讯云 COS：50G/月；200 万请求</li><li>腾讯云 CDN：10G/月</li><li>Cloudflare CDN：正常使用无上限</li><li>Cloudflare R2: 10G/月； 100 万/1000 万请求</li><li>Backblaze B2: 10G/月； 与 Cloudflare 有
<a href="/go/?target=aHR0cHM6Ly93d3cuYmFja2JsYXplLmNvbS9jbG91ZC1zdG9yYWdlL2ludGVncmF0aW9ucw%3d%3d" target=_blank rel="noopener noreferrer">流量联盟</a></li></ul><p>关于腾讯云的配置略过，这里只讲 Cloudflare 的部分。<br>前提需要 Cloudflare 账号中已经有一个可用的域名。<br>这个域名用来提供 <code>回退源</code> （Fallback Origin），假设这个域名是 <code>example.com</code> 。</p><h3 class="relative group">创建 R2 并绑定自定义域名<div id=创建-r2-并绑定自定义域名 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e5%88%9b%e5%bb%ba-r2-%e5%b9%b6%e7%bb%91%e5%ae%9a%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d aria-label=锚点>#</a></span></h3><ol><li>登录控制面板：
<a href="/go/?target=aHR0cHM6Ly9kYXNoLmNsb3VkZmxhcmUuY29tLw%3d%3d" target=_blank rel="noopener noreferrer">https://dash.cloudflare.com/</a> ，Cloudflare 已支持中文；</li><li>创建 R2 存储桶的方法这里略过，如创建：<code>r2-blog-test</code>；</li><li>在 <code>R2</code> <code>设置</code> <code>公开访问</code> <code>自定义域</code> <code>连接域</code> 为刚才创建的 R2 添加自定义域名：</li></ol><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/r2_custom_hostname.png></figure></p><p>然后该域名的 DNS 就会自动出现一条解析：</p><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/custom_hostname_dns.png></figure></p><h3 class="relative group">订阅 CloudFlare for SaaS<div id=订阅-cloudflare-for-saas class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e8%ae%a2%e9%98%85-cloudflare-for-saas aria-label=锚点>#</a></span></h3><ol><li>在 <code>Zones</code> 中选择 <code>example.com</code> 这个域名；</li><li>在该域名的 <code>SSL/TLS</code> 中选择 <code>自定义主机名</code>；</li><li>选择 Enable 订阅。可以使用 Paypal 订阅。</li></ol><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/enable_cloudflare_saas.png></figure></p><h3 class="relative group">添加自定义域名<div id=添加自定义域名 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e6%b7%bb%e5%8a%a0%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d aria-label=锚点>#</a></span></h3><p>订阅成功后，先添加 <code>回退源</code>：<code>images.example.com</code>，这个回源域名是绑定在 R2 上的自定义域名。</p><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/cf_callback_hostname.png></figure></p><p>然后点击 <code>添加自定义主机名</code> ，填入 CDN 域名，如 <code>images.eallion.com</code> ，验证方式推荐 TXT 验证。</p><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/add_custom_hostname.png></figure></p><p>添加后，需要验证域名，去自己的域名解析控制台，如 DNSPod ，添加 2 条 TXT 记录。<br>等待 <code>证书状态</code> 和 <code>主机名状态</code> 都变成 <code>有效</code>。</p><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/cf_dns_txt_records.png></figure></p><h3 class="relative group">解析 CNAME<div id=解析-cname class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e8%a7%a3%e6%9e%90-cname aria-label=锚点>#</a></span></h3><p><code>回退源状态</code> <code>证书状态</code> 和 <code>主机名状态</code> 都变成 <code>有效</code> 后，就去自己的域名解析控制台添加 CNAME 解析。<br>把用于生产环境的 <code>images.eallion.com</code> CNAME 指向 <code>images.example.com</code>。</p><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/dns_cname_records.png></figure></p><p>一般的教程到这里就结束了。<br>但是这样是访问不了 R2 里面的资源的。<br>最重要的一步，用 Worker 代理 R2。</p><h3 class="relative group">新建 Worker 代理 R2<div id=新建-worker-代理-r2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e6%96%b0%e5%bb%ba-worker-%e4%bb%a3%e7%90%86-r2 aria-label=锚点>#</a></span></h3><p>官方有文档介绍怎么通过 Worker 访问 R2：<br>Use R2 from Workers：
<a href="/go/?target=aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3IyL2FwaS93b3JrZXJzL3dvcmtlcnMtYXBpLXVzYWdlLw%3d%3d" target=_blank rel="noopener noreferrer">https://developers.cloudflare.com/r2/api/workers/workers-api-usage/</a></p><p>按照文档教程一步一步来就可以了。<br>如果比较懒，也不想鉴权。那用我的精简代码就可以了。<br>直接去掉了 <code>DELETE</code> 和 <code>PUT</code> 的代码，只保留了 <code>GET</code>。<br>不用 Wrangle CLI 脚本也可以在后台手动创建 Worker。</p><p>左侧切换到 <code>Worker 和 Pages</code> 分栏，<code>创建应用程序</code>，随便取个名字，随便选个模板部署就可以了，后面再改代码。</p><p>点击 <code>快速编辑</code> 把以下代码复制到 <code>worker.js</code> 中，保存并部署：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/worker.ts
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>worker_default</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span> <span class=o>!==</span> <span class=s2>&#34;GET&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s2>&#34;Only GET method allowed&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>status</span><span class=o>:</span> <span class=mi>405</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>env</span><span class=p>.</span><span class=nx>MY_BUCKET</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s2>&#34;Object not found&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>status</span><span class=o>:</span> <span class=mi>404</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>headers</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>object</span><span class=p>.</span><span class=nx>writeHttpMetadata</span><span class=p>(</span><span class=nx>headers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;ETag&#34;</span><span class=p>,</span> <span class=nx>object</span><span class=p>.</span><span class=nx>httpEtag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>object</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>worker_default</span> <span class=nx>as</span> <span class=k>default</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>//# sourceMappingURL=worker.js.map
</span></span></span></code></pre></div><p>部署成功后返回。<br>在当前 Worker 的设置中，<code>变量</code> <code>R2 存储桶绑定</code> 添加绑定：</p><ul><li><code>变量名称</code>：<code>MY_BUCKET</code></li><li><code>R2 存储桶</code>：选择对应的桶</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/r2_binding.png></figure></p><h3 class="relative group">Workers 路由<div id=workers-路由 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#workers-%e8%b7%af%e7%94%b1 aria-label=锚点>#</a></span></h3><p>回到 Zones 中，选择域名，添加 Workers 路由：</p><ul><li><code>路由</code>：一定要填生产环境用的域名，不要填 Cloudflare 的源域名，如：<code>images.eallion.com/*</code>；</li><li><code>Worker</code>：选择上一步创建的 Worker；</li><li><code>环境</code>：Production。</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/r2_worker_router.png></figure></p><p>至此，你应该就能以 CNAME 的方式访问 Cloudflare R2 里面的内容了。</p><ul><li><a href=https://images.eallion.com/eallion.jpg target=_blank rel="noopener noreferrer">https://images.eallion.com/eallion.jpg</a></li></ul><h3 class="relative group">Worker 代理 Backblaze B2<div id=worker-代理-backblaze-b2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#worker-%e4%bb%a3%e7%90%86-backblaze-b2 aria-label=锚点>#</a></span></h3><p>其实有 R2 就够了，但是可能会因为各种各样的原因需要用到 B2。</p><p>其实是差不多的。</p><p>Backblaze 官方也有文档介绍如何通过 Cloudflare Worker 访问 B2。<br>Docs：
<a href="/go/?target=aHR0cHM6Ly93d3cuYmFja2JsYXplLmNvbS9kb2NzL2Nsb3VkLXN0b3JhZ2UtaW50ZWdyYXRlLWNsb3VkZmxhcmUtd29ya2Vycy13aXRoLWJhY2tibGF6ZS1iMg%3d%3d" target=_blank rel="noopener noreferrer">Integrate Cloudflare Workers with Backblaze B2</a></p><p>简要介绍一下怎么做吧：（还是建议看官方文档比较好。）</p><h5 class="relative group">1、新建 Cloudflare Worker，<code>worker.js</code><div id=1新建-cloudflare-workerworkerjs class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#1%e6%96%b0%e5%bb%ba-cloudflare-workerworkerjs aria-label=锚点>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// node_modules/aws4fetch/dist/aws4fetch.esm.mjs
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>encoder</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TextEncoder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>HOST_SERVICES</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>appstream2</span><span class=o>:</span> <span class=s2>&#34;appstream&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>cloudhsmv2</span><span class=o>:</span> <span class=s2>&#34;cloudhsm&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=s2>&#34;ses&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>marketplace</span><span class=o>:</span> <span class=s2>&#34;aws-marketplace&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>mobile</span><span class=o>:</span> <span class=s2>&#34;AWSMobileHubService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pinpoint</span><span class=o>:</span> <span class=s2>&#34;mobiletargeting&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>queue</span><span class=o>:</span> <span class=s2>&#34;sqs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;git-codecommit&#34;</span><span class=o>:</span> <span class=s2>&#34;codecommit&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;mturk-requester-sandbox&#34;</span><span class=o>:</span> <span class=s2>&#34;mturk-requester&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;personalize-runtime&#34;</span><span class=o>:</span> <span class=s2>&#34;personalize&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>UNSIGNABLE_HEADERS</span> <span class=o>=</span> <span class=cm>/* @__PURE__ */</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;authorization&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;content-type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;content-length&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user-agent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;presigned-expires&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;expect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;x-amzn-trace-id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;connection&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>AwsClient</span> <span class=o>=</span> <span class=kr>class</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>({</span> <span class=nx>accessKeyId</span><span class=p>,</span> <span class=nx>secretAccessKey</span><span class=p>,</span> <span class=nx>sessionToken</span><span class=p>,</span> <span class=nx>service</span><span class=p>,</span> <span class=nx>region</span><span class=p>,</span> <span class=nx>cache</span><span class=p>,</span> <span class=nx>retries</span><span class=p>,</span> <span class=nx>initRetryMs</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>accessKeyId</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nx>TypeError</span><span class=p>(</span><span class=s2>&#34;accessKeyId is a required option&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>secretAccessKey</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nx>TypeError</span><span class=p>(</span><span class=s2>&#34;secretAccessKey is a required option&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>accessKeyId</span> <span class=o>=</span> <span class=nx>accessKeyId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>secretAccessKey</span> <span class=o>=</span> <span class=nx>secretAccessKey</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>sessionToken</span> <span class=o>=</span> <span class=nx>sessionToken</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>=</span> <span class=nx>service</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>region</span> <span class=o>=</span> <span class=nx>region</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>cache</span> <span class=o>=</span> <span class=nx>cache</span> <span class=o>||</span> <span class=cm>/* @__PURE__ */</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>retries</span> <span class=o>=</span> <span class=nx>retries</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=nx>retries</span> <span class=o>:</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>initRetryMs</span> <span class=o>=</span> <span class=nx>initRetryMs</span> <span class=o>||</span> <span class=mi>50</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>sign</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span> <span class=nx>init</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>input</span> <span class=k>instanceof</span> <span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>method</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>headers</span><span class=p>,</span> <span class=nx>body</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>input</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>init</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({</span> <span class=nx>method</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>headers</span> <span class=p>},</span> <span class=nx>init</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>init</span><span class=p>.</span><span class=nx>body</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=nx>headers</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>init</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=nx>body</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=nx>headers</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=s2>&#34;X-Amz-Content-Sha256&#34;</span><span class=p>)</span> <span class=o>?</span> <span class=nx>body</span> <span class=o>:</span> <span class=kr>await</span> <span class=nx>input</span><span class=p>.</span><span class=nx>clone</span><span class=p>().</span><span class=nx>arrayBuffer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>input</span> <span class=o>=</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>signer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AwsV4Signer</span><span class=p>(</span><span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>input</span> <span class=p>},</span> <span class=nx>init</span><span class=p>,</span> <span class=k>this</span><span class=p>,</span> <span class=nx>init</span> <span class=o>&amp;&amp;</span> <span class=nx>init</span><span class=p>.</span><span class=nx>aws</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>signed</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({},</span> <span class=nx>init</span><span class=p>,</span> <span class=kr>await</span> <span class=nx>signer</span><span class=p>.</span><span class=nx>sign</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=k>delete</span> <span class=nx>signed</span><span class=p>.</span><span class=nx>aws</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>Request</span><span class=p>(</span><span class=nx>signed</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=nx>signed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>e</span> <span class=k>instanceof</span> <span class=nx>TypeError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=k>new</span> <span class=nx>Request</span><span class=p>(</span><span class=nx>signed</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({</span> <span class=nx>duplex</span><span class=o>:</span> <span class=s2>&#34;half&#34;</span> <span class=p>},</span> <span class=nx>signed</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span> <span class=nx>init</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>retries</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>fetched</span> <span class=o>=</span> <span class=nx>fetch</span><span class=p>(</span><span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span> <span class=nx>init</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>i</span> <span class=o>===</span> <span class=k>this</span><span class=p>.</span><span class=nx>retries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nx>fetched</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetched</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>&lt;</span> <span class=mi>500</span> <span class=o>&amp;&amp;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>!==</span> <span class=mi>429</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nx>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>initRetryMs</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nx>i</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;An unknown error occurred, ensure retries is not negative&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>AwsV4Signer</span> <span class=o>=</span> <span class=kr>class</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>({</span> <span class=nx>method</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>headers</span><span class=p>,</span> <span class=nx>body</span><span class=p>,</span> <span class=nx>accessKeyId</span><span class=p>,</span> <span class=nx>secretAccessKey</span><span class=p>,</span> <span class=nx>sessionToken</span><span class=p>,</span> <span class=nx>service</span><span class=p>,</span> <span class=nx>region</span><span class=p>,</span> <span class=nx>cache</span><span class=p>,</span> <span class=nx>datetime</span><span class=p>,</span> <span class=nx>signQuery</span><span class=p>,</span> <span class=nx>appendSessionToken</span><span class=p>,</span> <span class=nx>allHeaders</span><span class=p>,</span> <span class=nx>singleEncode</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>url</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nx>TypeError</span><span class=p>(</span><span class=s2>&#34;url is a required option&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>accessKeyId</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nx>TypeError</span><span class=p>(</span><span class=s2>&#34;accessKeyId is a required option&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>secretAccessKey</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nx>TypeError</span><span class=p>(</span><span class=s2>&#34;secretAccessKey is a required option&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>method</span> <span class=o>=</span> <span class=nx>method</span> <span class=o>||</span> <span class=p>(</span><span class=nx>body</span> <span class=o>?</span> <span class=s2>&#34;POST&#34;</span> <span class=o>:</span> <span class=s2>&#34;GET&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>headers</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>(</span><span class=nx>headers</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>accessKeyId</span> <span class=o>=</span> <span class=nx>accessKeyId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>secretAccessKey</span> <span class=o>=</span> <span class=nx>secretAccessKey</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>sessionToken</span> <span class=o>=</span> <span class=nx>sessionToken</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>guessedService</span><span class=p>,</span> <span class=nx>guessedRegion</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>service</span> <span class=o>||</span> <span class=o>!</span><span class=nx>region</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nx>guessedService</span><span class=p>,</span> <span class=nx>guessedRegion</span><span class=p>]</span> <span class=o>=</span> <span class=nx>guessServiceRegion</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>=</span> <span class=nx>service</span> <span class=o>||</span> <span class=nx>guessedService</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>region</span> <span class=o>=</span> <span class=nx>region</span> <span class=o>||</span> <span class=nx>guessedRegion</span> <span class=o>||</span> <span class=s2>&#34;us-east-1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>cache</span> <span class=o>=</span> <span class=nx>cache</span> <span class=o>||</span> <span class=cm>/* @__PURE__ */</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>datetime</span> <span class=o>=</span> <span class=nx>datetime</span> <span class=o>||</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[:-]|\.\d{3}/g</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>signQuery</span> <span class=o>=</span> <span class=nx>signQuery</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>appendSessionToken</span> <span class=o>=</span> <span class=nx>appendSessionToken</span> <span class=o>||</span> <span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;iotdevicegateway&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s2>&#34;Host&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;s3&#34;</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>signQuery</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=s2>&#34;X-Amz-Content-Sha256&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Content-Sha256&#34;</span><span class=p>,</span> <span class=s2>&#34;UNSIGNED-PAYLOAD&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>signQuery</span> <span class=o>?</span> <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>searchParams</span> <span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>params</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Date&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>datetime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>sessionToken</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>appendSessionToken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>params</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Security-Token&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessionToken</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>signableHeaders</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;host&#34;</span><span class=p>,</span> <span class=p>...</span><span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>keys</span><span class=p>()].</span><span class=nx>filter</span><span class=p>((</span><span class=nx>header</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>allHeaders</span> <span class=o>||</span> <span class=o>!</span><span class=nx>UNSIGNABLE_HEADERS</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>header</span><span class=p>)).</span><span class=nx>sort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>signedHeaders</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>signableHeaders</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>canonicalHeaders</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>signableHeaders</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>header</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>header</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span> <span class=o>+</span> <span class=p>(</span><span class=nx>header</span> <span class=o>===</span> <span class=s2>&#34;host&#34;</span> <span class=o>?</span> <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>host</span> <span class=o>:</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>header</span><span class=p>)</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\s+/g</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>))).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;\n&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>credentialString</span> <span class=o>=</span> <span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>datetime</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>8</span><span class=p>),</span> <span class=k>this</span><span class=p>.</span><span class=nx>region</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>service</span><span class=p>,</span> <span class=s2>&#34;aws4_request&#34;</span><span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>signQuery</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;s3&#34;</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>params</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=s2>&#34;X-Amz-Expires&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>params</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Expires&#34;</span><span class=p>,</span> <span class=s2>&#34;86400&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>params</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Algorithm&#34;</span><span class=p>,</span> <span class=s2>&#34;AWS4-HMAC-SHA256&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>params</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Credential&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>accessKeyId</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>credentialString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>params</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-SignedHeaders&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>signedHeaders</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;s3&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span> <span class=o>=</span> <span class=nb>decodeURIComponent</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\+/g</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\/+/g</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>singleEncode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span> <span class=o>=</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/%2F/g</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span> <span class=o>=</span> <span class=nx>encodeRfc3986</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>seenKeys</span> <span class=o>=</span> <span class=cm>/* @__PURE__ */</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>encodedSearch</span> <span class=o>=</span> <span class=p>[...</span><span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>].</span><span class=nx>filter</span><span class=p>(([</span><span class=nx>k</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;s3&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>seenKeys</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=nx>seenKeys</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>pair</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>pair</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>p</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>encodeRfc3986</span><span class=p>(</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>p</span><span class=p>)))).</span><span class=nx>sort</span><span class=p>(([</span><span class=nx>k1</span><span class=p>,</span> <span class=nx>v1</span><span class=p>],</span> <span class=p>[</span><span class=nx>k2</span><span class=p>,</span> <span class=nx>v2</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=nx>k1</span> <span class=o>&lt;</span> <span class=nx>k2</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=nx>k1</span> <span class=o>&gt;</span> <span class=nx>k2</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=nx>v1</span> <span class=o>&lt;</span> <span class=nx>v2</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=nx>v1</span> <span class=o>&gt;</span> <span class=nx>v2</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>pair</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>pair</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;=&#34;</span><span class=p>)).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&amp;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>sign</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>signQuery</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Signature&#34;</span><span class=p>,</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>signature</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>sessionToken</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=p>.</span><span class=nx>appendSessionToken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Amz-Security-Token&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessionToken</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;Authorization&#34;</span><span class=p>,</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>authHeader</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>method</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>body</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>authHeader</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AWS4-HMAC-SHA256 Credential=&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>accessKeyId</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>credentialString</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;SignedHeaders=&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>signedHeaders</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Signature=&#34;</span> <span class=o>+</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>signature</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;, &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>signature</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>datetime</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>cacheKey</span> <span class=o>=</span> <span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>secretAccessKey</span><span class=p>,</span> <span class=nx>date</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>region</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>service</span><span class=p>].</span><span class=nx>join</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>kCredentials</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>cache</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>cacheKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>kCredentials</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>kDate</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>hmac</span><span class=p>(</span><span class=s2>&#34;AWS4&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>secretAccessKey</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>kRegion</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>hmac</span><span class=p>(</span><span class=nx>kDate</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>region</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>kService</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>hmac</span><span class=p>(</span><span class=nx>kRegion</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>service</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>kCredentials</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>hmac</span><span class=p>(</span><span class=nx>kService</span><span class=p>,</span> <span class=s2>&#34;aws4_request&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>cache</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>cacheKey</span><span class=p>,</span> <span class=nx>kCredentials</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>buf2hex</span><span class=p>(</span><span class=kr>await</span> <span class=nx>hmac</span><span class=p>(</span><span class=nx>kCredentials</span><span class=p>,</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>stringToSign</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>stringToSign</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AWS4-HMAC-SHA256&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>datetime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>credentialString</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>buf2hex</span><span class=p>(</span><span class=kr>await</span> <span class=nx>hash</span><span class=p>(</span><span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>canonicalString</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>      <span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;\n&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>canonicalString</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>method</span><span class=p>.</span><span class=nx>toUpperCase</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>encodedPath</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>encodedSearch</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>canonicalHeaders</span> <span class=o>+</span> <span class=s2>&#34;\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>signedHeaders</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>hexBodyHash</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;\n&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>hexBodyHash</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>hashHeader</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;X-Amz-Content-Sha256&#34;</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;s3&#34;</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=p>.</span><span class=nx>signQuery</span> <span class=o>?</span> <span class=s2>&#34;UNSIGNED-PAYLOAD&#34;</span> <span class=o>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>hashHeader</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>body</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=k>this</span><span class=p>.</span><span class=nx>body</span> <span class=o>!==</span> <span class=s2>&#34;string&#34;</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=s2>&#34;byteLength&#34;</span> <span class=k>in</span> <span class=k>this</span><span class=p>.</span><span class=nx>body</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>hashHeader</span> <span class=o>=</span> <span class=nx>buf2hex</span><span class=p>(</span><span class=kr>await</span> <span class=nx>hash</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>body</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>hashHeader</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>hmac</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>cryptoKey</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>subtle</span><span class=p>.</span><span class=nx>importKey</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;raw&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>typeof</span> <span class=nx>key</span> <span class=o>===</span> <span class=s2>&#34;string&#34;</span> <span class=o>?</span> <span class=nx>encoder</span><span class=p>.</span><span class=nx>encode</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span> <span class=o>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;HMAC&#34;</span><span class=p>,</span> <span class=nx>hash</span><span class=o>:</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;SHA-256&#34;</span> <span class=p>}</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>subtle</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span><span class=s2>&#34;HMAC&#34;</span><span class=p>,</span> <span class=nx>cryptoKey</span><span class=p>,</span> <span class=nx>encoder</span><span class=p>.</span><span class=nx>encode</span><span class=p>(</span><span class=nx>string</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>hash</span><span class=p>(</span><span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>subtle</span><span class=p>.</span><span class=nx>digest</span><span class=p>(</span><span class=s2>&#34;SHA-256&#34;</span><span class=p>,</span> <span class=k>typeof</span> <span class=nx>content</span> <span class=o>===</span> <span class=s2>&#34;string&#34;</span> <span class=o>?</span> <span class=nx>encoder</span><span class=p>.</span><span class=nx>encode</span><span class=p>(</span><span class=nx>content</span><span class=p>)</span> <span class=o>:</span> <span class=nx>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>buf2hex</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>map</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>(</span><span class=nx>buffer</span><span class=p>),</span> <span class=p>(</span><span class=nx>x</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=s2>&#34;0&#34;</span> <span class=o>+</span> <span class=nx>x</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>)).</span><span class=nx>slice</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>)).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>encodeRfc3986</span><span class=p>(</span><span class=nx>urlEncodedStr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>urlEncodedStr</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[!&#39;()*]/g</span><span class=p>,</span> <span class=p>(</span><span class=nx>c</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=s2>&#34;%&#34;</span> <span class=o>+</span> <span class=nx>c</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=mi>0</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>).</span><span class=nx>toUpperCase</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>guessServiceRegion</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>headers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>hostname</span><span class=p>,</span> <span class=nx>pathname</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>hostname</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s2>&#34;.r2.cloudflarestorage.com&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>[</span><span class=s2>&#34;s3&#34;</span><span class=p>,</span> <span class=s2>&#34;auto&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>hostname</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s2>&#34;.backblazeb2.com&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>match2</span> <span class=o>=</span> <span class=nx>hostname</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=sr>/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>match2</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=p>[</span><span class=s2>&#34;s3&#34;</span><span class=p>,</span> <span class=nx>match2</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span> <span class=o>:</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>match</span> <span class=o>=</span> <span class=nx>hostname</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s2>&#34;dualstack.&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>).</span><span class=nx>match</span><span class=p>(</span><span class=sr>/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=p>[</span><span class=nx>service</span><span class=p>,</span> <span class=nx>region</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=nx>match</span> <span class=o>||</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>]).</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>region</span> <span class=o>===</span> <span class=s2>&#34;us-gov&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>region</span> <span class=o>=</span> <span class=s2>&#34;us-gov-west-1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>region</span> <span class=o>===</span> <span class=s2>&#34;s3&#34;</span> <span class=o>||</span> <span class=nx>region</span> <span class=o>===</span> <span class=s2>&#34;s3-accelerate&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>region</span> <span class=o>=</span> <span class=s2>&#34;us-east-1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>service</span> <span class=o>=</span> <span class=s2>&#34;s3&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;iot&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>hostname</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s2>&#34;iot.&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>service</span> <span class=o>=</span> <span class=s2>&#34;execute-api&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>hostname</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s2>&#34;data.jobs.iot.&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>service</span> <span class=o>=</span> <span class=s2>&#34;iot-jobs-data&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>service</span> <span class=o>=</span> <span class=nx>pathname</span> <span class=o>===</span> <span class=s2>&#34;/mqtt&#34;</span> <span class=o>?</span> <span class=s2>&#34;iotdevicegateway&#34;</span> <span class=o>:</span> <span class=s2>&#34;iotdata&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>service</span> <span class=o>===</span> <span class=s2>&#34;autoscaling&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>targetPrefix</span> <span class=o>=</span> <span class=p>(</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;X-Amz-Target&#34;</span><span class=p>)</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>).</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>targetPrefix</span> <span class=o>===</span> <span class=s2>&#34;AnyScaleFrontendService&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>service</span> <span class=o>=</span> <span class=s2>&#34;application-autoscaling&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>targetPrefix</span> <span class=o>===</span> <span class=s2>&#34;AnyScaleScalingPlannerFrontendService&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>service</span> <span class=o>=</span> <span class=s2>&#34;autoscaling-plans&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>region</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=nx>service</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s2>&#34;s3-&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>region</span> <span class=o>=</span> <span class=nx>service</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>3</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/^fips-|^external-1/</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>service</span> <span class=o>=</span> <span class=s2>&#34;s3&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s2>&#34;-fips&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>service</span> <span class=o>=</span> <span class=nx>service</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>region</span> <span class=o>&amp;&amp;</span> <span class=sr>/-\d$/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>service</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=sr>/-\d$/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>region</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=nx>service</span><span class=p>,</span> <span class=nx>region</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=nx>region</span><span class=p>,</span> <span class=nx>service</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nx>HOST_SERVICES</span><span class=p>[</span><span class=nx>service</span><span class=p>]</span> <span class=o>||</span> <span class=nx>service</span><span class=p>,</span> <span class=nx>region</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// index.js
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>UNSIGNABLE_HEADERS2</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;x-forwarded-proto&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;x-real-ip&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>filterHeaders</span><span class=p>(</span><span class=nx>headers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>headers</span><span class=p>.</span><span class=nx>entries</span><span class=p>()).</span><span class=nx>filter</span><span class=p>((</span><span class=nx>pair</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>UNSIGNABLE_HEADERS2</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>pair</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>pair</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>startsWith</span><span class=p>(</span><span class=s2>&#34;cf-&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>handleRequest</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>client2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>request</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=s2>&#34;HEAD&#34;</span><span class=p>].</span><span class=nx>includes</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>status</span><span class=o>:</span> <span class=mi>405</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>statusText</span><span class=o>:</span> <span class=s2>&#34;Method Not Allowed&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/^\//</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\/$/</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>pathSegments</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>ALLOW_LIST_BUCKET</span> <span class=o>!==</span> <span class=s2>&#34;true&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>BUCKET_NAME</span> <span class=o>===</span> <span class=s2>&#34;$path&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>pathSegments</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=mi>2</span> <span class=o>||</span> <span class=nx>BUCKET_NAME</span> <span class=o>!==</span> <span class=s2>&#34;$path&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>path</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>status</span><span class=o>:</span> <span class=mi>404</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>statusText</span><span class=o>:</span> <span class=s2>&#34;Not Found&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>BUCKET_NAME</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;$path&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span><span class=p>.</span><span class=nx>hostname</span> <span class=o>=</span> <span class=nx>B2_ENDPOINT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;$host&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span><span class=p>.</span><span class=nx>hostname</span> <span class=o>=</span> <span class=nx>url</span><span class=p>.</span><span class=nx>hostname</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=nx>B2_ENDPOINT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span><span class=p>.</span><span class=nx>hostname</span> <span class=o>=</span> <span class=nx>BUCKET_NAME</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=nx>B2_ENDPOINT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>headers</span> <span class=o>=</span> <span class=nx>filterHeaders</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>headers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>signedRequest</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client2</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span><span class=nx>url</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>signedRequest</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>endpointRegex</span> <span class=o>=</span> <span class=sr>/^s3\.([a-zA-Z0-9-]+)\.backblazeb2\.com$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=p>[,</span> <span class=nx>aws_region</span><span class=p>]</span> <span class=o>=</span> <span class=nx>B2_ENDPOINT</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>endpointRegex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AwsClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;accessKeyId&#34;</span><span class=o>:</span> <span class=nx>B2_APPLICATION_KEY_ID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;secretAccessKey&#34;</span><span class=o>:</span> <span class=nx>B2_APPLICATION_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;service&#34;</span><span class=o>:</span> <span class=s2>&#34;s3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;region&#34;</span><span class=o>:</span> <span class=nx>aws_region</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;fetch&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>event</span><span class=p>.</span><span class=nx>respondWith</span><span class=p>(</span><span class=nx>handleRequest</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>client</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span><span class=line><span class=cl><span class=c1>//# sourceMappingURL=index.js.map
</span></span></span></code></pre></div><h5 class="relative group">2、设置 Worker 环境变量<div id=2设置-worker-环境变量 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#2%e8%ae%be%e7%bd%ae-worker-%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f aria-label=锚点>#</a></span></h5><ul><li><code>ALLOW_LIST_BUCKET</code>：true</li><li><code>B2_APPLICATION_KEY</code>：K004WJZP11111111111111111111Q</li><li><code>B2_APPLICATION_KEY_ID</code>：0042e9999999920000000001</li><li><code>B2_ENDPOINT</code>：s3.us-west-004.backblazeb2.com</li><li><code>BUCKET_NAME</code>：eallion-static</li></ul><p>APP KEY 和 ID 要去 Backblaze 后台生成，<code>B2_ENDPOINT</code> 要去自己的 B2 存储桶里查看。</p><h5 class="relative group">3、手动添加 CNAME 解析到 B2<div id=3手动添加-cname-解析到-b2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#3%e6%89%8b%e5%8a%a8%e6%b7%bb%e5%8a%a0-cname-%e8%a7%a3%e6%9e%90%e5%88%b0-b2 aria-label=锚点>#</a></span></h5><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/b2_cf_record.png></figure></p><ul><li><code>类型</code>：选 <code>CNAME</code></li><li><code>名称</code>：用于 <code>回退源</code>，如：<code>b2.example.com</code> ，就填入 <code>b2</code></li><li><code>内容</code>：填入自己 B2 存储桶分配的 <code>S3 URL</code> ，有的教程这里写的是 <code>Friendly URL</code> ，没必要，还要多一步反代。</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt src=/assets/images/posts/2023/07/backblaze_url.png></figure></p><h5 class="relative group">4、配置回退源<div id=4配置回退源 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#4%e9%85%8d%e7%bd%ae%e5%9b%9e%e9%80%80%e6%ba%90 aria-label=锚点>#</a></span></h5><p><code>Zones</code> 中的域名为 Backblaze B2 设置的 CNAME 名称是什么，那回退源就填什么，如：<code>b2.example.com</code>。<br>参考前文即可。</p><h5 class="relative group">5、配置自定义主机名<div id=5配置自定义主机名 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#5%e9%85%8d%e7%bd%ae%e8%87%aa%e5%ae%9a%e4%b9%89%e4%b8%bb%e6%9c%ba%e5%90%8d aria-label=锚点>#</a></span></h5><p>参考前文。</p><h5 class="relative group">6、配置 Worker 路由<div id=6配置-worker-路由 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#6%e9%85%8d%e7%bd%ae-worker-%e8%b7%af%e7%94%b1 aria-label=锚点>#</a></span></h5><ul><li><code>路由</code>：一定要填生产环境用的域名，不要填 Cloudflare 的源域名；</li><li><code>Worker</code>：选择上一步创建的 Worker；</li><li><code>环境</code>：Production。</li></ul><p>为 Backblaze B2 添加 Worker 路由与 Cloudflare R2 不同，需要添加 2 条：</p><ul><li><code>b2.example.com/*</code> 也需要加入 Worker 路由中</li><li><code>images.eallion.com/*</code></li></ul><h3 class="relative group">尾声<div id=尾声 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e5%b0%be%e5%a3%b0 aria-label=锚点>#</a></span></h3><p>写长博客太折磨人了！主要是怕自己过一段时间会忘记怎么配置的，写个备忘录记录一下。</p></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://www.eallion.com/cdn-cname-cloudflare/&amp;text=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title="分享到 Twitter" aria-label="分享到 Twitter"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://www.eallion.com/cdn-cname-cloudflare/&amp;quote=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title="分享到 Facebook" aria-label="分享到 Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://s2f.kytta.dev/?text=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81%20https://www.eallion.com/cdn-cname-cloudflare/" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://www.eallion.com/cdn-cname-cloudflare/&amp;resubmit=true&amp;title=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title="提交到 Reddit" aria-label="提交到 Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://www.eallion.com/cdn-cname-cloudflare/&amp;resubmit=true&amp;title=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://www.eallion.com/cdn-cname-cloudflare/&amp;resubmit=true&amp;title=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title aria-label><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.eallion.com/cdn-cname-cloudflare/&amp;title=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title="分享到 LinkedIn" aria-label="分享到 LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.eallion.com/cdn-cname-cloudflare/&amp;description=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title="钉到 Pinterest" aria-label="钉到 Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://bsky.app/intent/compose?text=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81+https://www.eallion.com/cdn-cname-cloudflare/" title aria-label><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://www.eallion.com/cdn-cname-cloudflare/&amp;subject=%e5%9b%be%e5%ba%8a%20CDN%20CNAME%20%e6%8e%a5%e5%85%a5%20Cloudflare%20SaaS%20%e5%ae%9e%e7%8e%b0%e5%88%86%e6%b5%81" title=通过电子邮件发送 aria-label=通过电子邮件发送><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_blog/code/cdn-cname-cloudflare/index.md data-oid-likes=likes_blog/code/cdn-cname-cloudflare/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/s3-sync/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">利用 GitHub Actions 同步对象存储</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-07-28T09:06:50+00:00>Jul 28, 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/self-hosted-github-flavored-reactions/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">自部署 GitHub 风格的 Reactions 点赞功能</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-08-06T07:25:40+00:00>Aug 6, 2023</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div class="comment-on flex flex-col md:flex-row items-start md:items-center mt-8 text-base capitalize print:hidden"><div id=load-giscus class="inline-flex items-center relative"><span class=cursor-pointer>Click to load</span>
<span class="ml-2 mr-1 cursor-pointer"><span class="relative block icon"><svg width="210" height="180" viewBox="0 0 210 180" fill="none"><path d="M110.743 169.825 200.694 64.8809C203.014 62.1745 203.109 58.2092 200.92 55.3954l-35-45C164.499 8.56855 162.314 7.5 160 7.5H130 80 50c-2.3144.0-4.4992 1.06855-5.9201 2.8954l-35.00004 45C6.89141 58.2092 6.98577 62.1745 9.30558 64.8809L99.2573 169.825C99.4522 170.056 99.6603 170.276 99.8804 170.481 100.287 170.861 100.735 171.194 101.215 171.475 102.339 172.132 103.638 172.5 105 172.5 105.195 172.5 105.388 172.492 105.579 172.478 106.588 172.4 107.553 172.12 108.426 171.672 108.879 171.439 109.307 171.161 109.703 170.842 110.08 170.539 110.429 170.198 110.743 169.825z" stroke="#000" stroke-width="15" stroke-linejoin="round"/><path d="M80 15H50L15 60H65L80 15z" fill="#BDDDF4"/><path d="M195 60 160 15H130l15 45h50z" fill="#5DADEC"/><path d="M145 60h50L105 165 145 60z" fill="#4289C1"/><path d="M65 60H15l90 105L65 60z" fill="#8CCAF7"/><path d="M80 15 65 60h80L130 15H80z" fill="#8CCAF7"/><path d="M105 165 65 60h80L105 165z" fill="#5DADEC"/></svg>
</span></span><span class='mr-2 opacity-75 hover:opacity-100 cursor-pointer duration-300 ease-in-out'>Giscus</span></div><div id=load-giscus-desc class="block md:inline-block mr-2 text-sm md:text-base lowercase md:capitalize">or</div><div id=link-to-mastodon class="flex items-center relative"><span class=cursor-pointer>discuss on </span><span class="ml-2 cursor-pointer"><span class="relative block icon"><svg width="75" height="79" viewBox="0 0 75 79" fill="none"><path d="M73.8393 17.4898C72.6973 9.00165 65.2994 2.31235 56.5296 1.01614 55.05.797115 49.4441.0 36.4582.0H36.3612C23.3717.0 20.585.797115 19.1054 1.01614 10.5798 2.27644 2.79399 8.28712.904997 16.8758-.00358524 21.1056-.100549 25.7949.0682394 30.0965.308852 36.2651.355538 42.423.91577 48.5665c.3873 4.0809 1.06295 8.1292 2.02186 12.1147C4.73325 68.042 12.0019 74.1676 19.1233 76.6666c7.6245 2.6062 15.8241 3.0389 23.6806 1.2496C43.6682 77.7151 44.5217 77.4817 45.3645 77.216 47.275 76.6092 49.5123 75.9305 51.1571 74.7385 51.1797 74.7217 51.1982 74.7001 51.2112 74.6753 51.2243 74.6504 51.2316 74.6229 51.2325 74.5948V68.6416C51.2321 68.6154 51.2259 68.5896 51.2142 68.5661 51.2025 68.5426 51.1858 68.522 51.1651 68.5058 51.1444 68.4896 51.1204 68.4783 51.0948 68.4726S51.0426 68.467 51.0171 68.4729c-5.0336 1.2021-10.1917 1.8048-15.3669 1.7953C26.7439 70.2682 24.3486 66.042 23.6626 64.2826 23.1113 62.762 22.7612 61.1759 22.6212 59.5646 22.6197 59.5375 22.6247 59.5105 22.6357 59.4857 22.6466 59.4609 22.6633 59.4391 22.6843 59.422 22.7053 59.4048 22.73 59.3929 22.7565 59.3871 22.783 59.3813 22.8104 59.3818 22.8367 59.3886c4.9497 1.194 10.0237 1.7967 15.1155 1.7953 1.2246.0 2.4456.0 3.6702-.0322999999999993C46.7435 61.008 52.1411 60.7459 57.1796 59.7621 57.3053 59.7369 57.431 59.7154 57.5387 59.6831 65.4861 58.157 73.0493 53.3672 73.8178 41.2381 73.8465 40.7606 73.9184 36.2364 73.9184 35.7409 73.9219 34.0569 74.4606 23.7949 73.8393 17.4898z" fill="url(#paint0_linear_549_34)"/><path d="M61.2484 27.0263V48.114H52.8916V27.6475c0-4.3087-1.7956-6.5062-5.4479-6.5062-4.015.0-6.026 2.5996-6.026 7.7342V40.0782H33.1111V28.8755c0-5.1346-2.0146-7.7342-6.0296-7.7342-3.6308.0-5.4444 2.1975-5.4444 6.5062V48.114H13.2839V27.0263c0-4.3087 1.1001-7.7317 3.3004-10.2691 2.2696-2.5314 5.2468-3.8312 8.9421-3.8312 4.2772.0 7.5093 1.6445 9.6641 4.9299l2.0793 3.4901 2.0829-3.4901c2.1547-3.2854 5.3868-4.9299 9.6568-4.9299 3.6918.0 6.6689 1.2998 8.9458 3.8312 2.1978 2.535 3.2955 5.958 3.2931 10.2691z" fill="#fff"/><defs><linearGradient id="paint0_linear_549_34" x1="37.0692" y1="0" x2="37.0692" y2="79" gradientUnits="userSpaceOnUse"><stop stop-color="#6364FF"/><stop offset="1" stop-color="#563ACC"/></linearGradient></defs></svg>
</span></span><span class='ml-1 opacity-75 hover:opacity-100 cursor-pointer duration-300 ease-in-out'><a href=https://s.e5n.cc/cdn-cname-cloudflare target=_blank rel=noopener>Mastodon</a></span>
<span><span class="relative block icon"><svg width="1rem" height="1rem" viewBox="0 0 32 32"><path fill="currentColor" d="M18 5v2h5.563L11.28 19.281l1.438 1.438L25 8.437V14h2V5zM5 9v18h18V14l-2 2v9H7V11h9l2-2z"/></svg></span></span></div></div><div id=comments></div><script>function loadGiscus(){return new Promise(e=>{const t=document.createElement("script");t.src="https://giscus.app/client.js",t.setAttribute("data-repo","eallion/eallion.com"),t.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkyNjI2Njk1MDg="),t.setAttribute("data-category","Giscus"),t.setAttribute("data-category-id","DIC_kwDOD6gExM4CS9eF"),t.setAttribute("data-mapping","pathname"),t.setAttribute("data-strict","1"),t.setAttribute("data-reactions-enabled","1"),t.setAttribute("data-emit-metadata","0"),t.setAttribute("data-input-position","bottom"),t.setAttribute("data-lang","zh-CN"),t.setAttribute("data-loading","lazy"),t.setAttribute("crossorigin","anonymous"),t.async=!0;const n=document.documentElement;n.classList.contains("dark")?t.setAttribute("data-theme","dark_dimmed"):t.setAttribute("data-theme","light"),t.addEventListener("load",()=>{e()}),document.getElementById("comments").appendChild(t)})}document.getElementById("load-giscus").addEventListener("click",async()=>{await loadGiscus(),document.getElementById("load-giscus").classList.add("!hidden"),document.getElementById("load-giscus-desc").classList.add("!hidden"),document.getElementById("link-to-mastodon").classList.add("mb-8")})</script></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=返回顶部 title=返回顶部>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-row list-none gap-5"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=https://notbyai.fyi title><div id=notbyai class="notbyai written"></div></a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=https://nonbot.org/pledged/view/9cefed7c-dc57-4832-84ec-197314fda979 title><div id=nonbot class=nonbot></div></a></li></ul></nav><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/stats/ title=博客统计>统计</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/milestone/ title=里程碑>里程碑</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/copyright/ title=版权信息>版权信息</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/privacy-policy/ title=隐私政策>隐私政策</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/links/ title=友情链接>友情链接</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/about/ title=关于>关于</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=https://status.eallion.com/ title>Status <svg width="1rem" height="1rem" viewBox="0 0 32 32"><path fill="currentcolor" d="M18 5v2h5.563L11.28 19.281l1.438 1.438L25 8.437V14h2V5zM5 9v18h18V14l-2 2v9H7V11h9l2-2z"/></svg></a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=https://www.eallion.com/rss title><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg>
</span></span>RSS</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2006 - 2025 <span class=inline-block><a href=/copyright/ target=_blank>eallion.com</a> All Rights Reserved</span>. <span class=inline-block><a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备16031768号-2</a></span></p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a> 强力驱动</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://www.eallion.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div><script>(function(){var t,n,s,o=["ZWFsbGlvbi5jb20=","d3d3LmVhbGxpb24uY29t","bG9jYWxob3N0","MTI3LjAuMC4x","MTkyLjE2OC4wLjU=","dGVzdC5lYWxsaW9uLmNvbQ==","YmxvZy5lYWxsaW9uLmNvbQ=="],i="aHR0cHM6Ly93d3cuZWFsbGlvbi5jb20=";function e(e){return atob(e)}t=o.map(e),n=e(i),s=document.location.hostname,t.includes(s)||(window.location.href=n)})()</script><progress id=content_progress value=0></progress>
<script>document.addEventListener("DOMContentLoaded",function(){var t=window.innerHeight,n=document.documentElement.scrollHeight,e=document.querySelector("#content_progress");e.max=n-t,e.value=window.scrollY,document.addEventListener("scroll",function(){e.max=document.documentElement.scrollHeight-window.innerHeight,e.value=window.scrollY})})</script><script type=text/javascript src=/js/heti-addon.min.6c6f2160cd810f2e97332d731317ec0c364ddd452c8ac61d63f3a7f36e5b1e87.js integrity="sha256-bG8hYM2BDy6XMy1zExfsDDZN3UUsisYdY/On825bHoc="></script><script>const heti=new Heti(".heti");heti.autoSpacing()</script></body></html>